{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load core_template_tags %}

{% block title %}{{title}}{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-12">
        <form class="ajax redirect hide_placeholder" method="post" action="{{request.get_full_path}}">
            <div class="card ">
                <div class="card-header card-header-rose card-header-icon">
                    <div class="card-icon">
                        <i class="material-icons">mail_outline</i>
                    </div>
                    <div class="d-flex justify-content-between">
                        <h4 class="card-title">{{title}}</h4>
                        {% if instance %}
                        <div class="button-items text-right">
                            <a href="{{ instance.get_create_url }}" class="btn btn-success btn-icon-square-sm"><i class="fas fa-plus"></i></a>
                            <a href="{{ instance.get_destroy_url }}" data-id="{{ instance.pk }}" data-text="Are you sure you want to delete this Item?" data-title="Are you sure?" class="btn btn-danger btn-icon-square-sm action-button remove redirect"><i class="fas fa-trash-alt" title="Delete"></i></a>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    {% csrf_token %}

                    <div class="row">
                        <!-- Odd Column -->
                        <div class="col-md-6">
                            {% for field in form %}
                            {% if forloop.counter0|divisibleby:2 %}
                            {% include 'crud/includes/entry_input.html' with field=field %}
                            {% endif %}
                            {% endfor %}
                        </div>
                        <!-- Even Column -->
                        <div class="col-md-6">
                            {% for field in form %}
                            {% if not forloop.counter0|divisibleby:2 %}
                            {% include 'crud/includes/entry_input.html' with field=field %}
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% for formset in formsets %}
                <div class="card-header">
                    <h4 class="card-title">{{formset.forms.0|get_model_verbose}}</h4>
                </div>

                <!--end card-header-->
                <div class="card-body">


                    <div class="table-responsive {{formset.prefix}}">
                        <table class="table mb-0">
                            <thead class="thead-light">
                                <tr>
                                    {% for field in formset.forms.0.visible_fields %}
                                    {% if not formset.forms.0|get_fk_field:form == field.name and field.name in formset.forms.0.base_fields.keys %}
                                    <th>
                                        {{ field.label }}
                                    </th>
                                    {% endif %}
                                    {% endfor %}
                                    <th>ACN</td>
                                </tr>
                            </thead>
                            <tbody>
                                {% for form in formset.forms %}
                                <tr class="form_set_row {% if not form.initial %}delete_formset_row{% endif%}">
                                    {{form.id}}
                                    {% for hidden in form.hidden_fields %} {{hidden}} {% endfor %}
                                    {% for field in form.visible_fields %}
                                    {% if not formset|get_fk_field:form == field.name and field.name in form.base_fields.keys %}
                                    <td>
                                        {{ field}}
                                    </td>
                                    {% endif %}
                                    {% endfor %}
                                    <td>
                                        {% if form.initial %}{{ form.DELETE }}{% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {{formset.management_form}}
                    </div>

                </div>

                <!--end card-body-->
            </div>
            {% endfor %}
            <div class="card-footer ">
                <input type="submit" class="btn btn-fill btn-rose" name="_add_view" value="Save & View" />
            </div>
        </form>
    </div>
</div> <!-- end row -->

{% endblock %}

{% block static %}
{{form.media}}
<script type="text/javascript" src="{% static 'assets/js/jquery.formset.js' %}"></script>
{% for formset in formsets %}
{{formset.form.media}}
<script>
    $('div.{{formset.prefix}} table tr.form_set_row').formset({
        prefix: '{{ formset.prefix }}',
        formCssClass: 'dynamic-formset-{{ formset.prefix }}',
        addCssClass: 'btn btn-sm btn-outline-primary add',
        addText: '<i class="fas fa-plus"></i>',
        deleteCssClass: 'btn btn-sm btn-outline-primary delete',
        deleteText: '<i class="fas fa-minus"></i>',
        'added': function (row) {
        }
    });
</script>
{% endfor %}
{% endblock %}